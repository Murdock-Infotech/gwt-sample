<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Modular Web Application</title>
  <!-- Runtime config from Spring Boot (application.properties) -->
  <script type="text/javascript" language="javascript" src="/client-config.js"></script>
  <script>
    (function() {
      // Default: load the GWT bootstrap from the backend so RPC serialization policies
      // are loaded from the same origin (/modularwebapp/*.gwt.rpc).
      //
      // For Super Dev Mode, run CodeServer on :9876 and open:
      //   http://localhost:8080/?gwt.codesvr=localhost:9876
      // This keeps the module base on :8080 while using the CodeServer for recompiles.
      var params = new URLSearchParams(window.location.search);
      var codesvr = params.get('gwt.codesvr') || params.get('codesvr');
      var src = '/modularwebapp/modularwebapp.nocache.js';
      if (codesvr) {
        src += '?gwt.codesvr=' + encodeURIComponent(codesvr);
      }

      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.src = src;
      s.onerror = function() { window.__gwt_bootstrap_failed = true; };
      document.head.appendChild(s);
    })();
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-top: 0;
    }
    #gwt-loading {
      display: none;
      margin-top: 20px;
      padding: 15px;
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      border-radius: 4px;
    }
    #gwt-root {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Modular Web Application</h1>

    <div id="gwt-root">
      <div><strong>GWT client UI:</strong></div>
      <div id="gwtRoot"></div>
    </div>

    <div id="gwt-loading">
      <strong>GWT client not loaded - be sure the CodeServer is running.</strong>
      <div id="gwt-loading-details" style="margin-top: 8px;"></div>
    </div>
  </div>

  <noscript>
    <div style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
      Your web browser must have JavaScript enabled in order for this application to display correctly.
    </div>
  </noscript>

  <script>
    function showGwtLoading(msg) {
      var box = document.getElementById('gwt-loading');
      var details = document.getElementById('gwt-loading-details');
      details.textContent = msg || '';
      box.style.display = 'block';
    }

    // Diagnostics for common "it doesn't render" cases:
    // - Viewing this HTML as a file (file://) instead of via the running server
    // - Missing /modularwebapp/modularwebapp.nocache.js at runtime
    window.addEventListener('load', function() {
      if (window.location.protocol === 'file:') {
        showGwtLoading("You're viewing this page via file://. Start the server and open http://localhost:8080/ so /modularwebapp/* can be served.");
        return;
      }

      setTimeout(function() {
        if (window.__gwt_bootstrap_failed) {
          showGwtLoading("Failed to load /modularwebapp/modularwebapp.nocache.js (404 or blocked). Build first (mvn compile) then run the server from modular-webapp-server.");
          return;
        }
      }, 750);
    });
  </script>
</body>
</html>

